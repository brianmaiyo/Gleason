 document.addEventListener('DOMContentLoaded',function(){console.log('Gleason Construction website loaded');loadNonCriticalCSS();initMobileNav();initProjectsSlider();initTestimonials();initServiceDetailNavigation();initProjectsFilter();initProjectDetailView();initContactForm();initGoogleMaps();});function initMobileNav(){const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');if(mobileMenuToggle){mobileMenuToggle.addEventListener('click',function(){toggleMobileNav();});}document.addEventListener('click',function(event){const isClickInsideNav = event.target.closest('.main-navigation');const isNavOpen = document.body.classList.contains('mobile-menu-open');if(!isClickInsideNav && isNavOpen){toggleMobileNav();}});window.addEventListener('resize',function(){if(window.innerWidth > 768 && document.body.classList.contains('mobile-menu-open')){document.body.classList.remove('mobile-menu-open');mobileMenuToggle.setAttribute('aria-expanded','false');}});}function toggleMobileNav(){const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');const isExpanded = mobileMenuToggle.getAttribute('aria-expanded')=== 'true';document.body.classList.toggle('mobile-menu-open');mobileMenuToggle.setAttribute('aria-expanded',!isExpanded);}function validateForm(formElement){let isValid = true;const errorElements = formElement.querySelectorAll('.error-message');errorElements.forEach(element =>{element.style.display = 'none';});const inputElements = formElement.querySelectorAll('.form-control');inputElements.forEach(input =>{input.classList.remove('error');});const requiredFields = formElement.querySelectorAll('[required]');requiredFields.forEach(field =>{if(!field.value.trim()){displayError(field,`${getFieldLabel(field)}is required`);isValid = false;}});const emailField = formElement.querySelector('input[type="email"]');if(emailField && emailField.value.trim()){const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;if(!emailRegex.test(emailField.value.trim())){displayError(emailField,'Please enter a valid email address');isValid = false;}else{emailField.value = emailField.value.trim().toLowerCase();}}const phoneField = formElement.querySelector('input[type="tel"]');if(phoneField && phoneField.value.trim()){const phoneRegex = /^[+]?[(]?[0-9]{1,4}[)]?[-\s.]?[0-9]{1,3}[-\s.]?[0-9]{1,4}[-\s.]?[0-9]{1,4}$/;if(!phoneRegex.test(phoneField.value.trim())){displayError(phoneField,'Please enter a valid phone number(e.g.,+254 701 596 894)');isValid = false;}else{phoneField.value = phoneField.value.trim().replace(/\s+/g,' ');}}const textInputs = formElement.querySelectorAll('input[type="text"],textarea');textInputs.forEach(input =>{if(input.value.trim()){const scriptRegex = /<script|<\/script|javascript:|on\w+=/i;if(scriptRegex.test(input.value)){displayError(input,'Please remove any code or script tags from your input');isValid = false;}else{input.value = sanitizeInput(input.value);}}});const csrfToken = document.querySelector('meta[name="csrf-token"]');if(csrfToken){const tokenInput = document.createElement('input');tokenInput.type = 'hidden';tokenInput.name = 'csrf_token';tokenInput.value = csrfToken.getAttribute('content');formElement.appendChild(tokenInput);}return isValid;}function sanitizeInput(input){const map ={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'};return input.replace(/[&<>"']/g,function(m){return map[m];});}function displayError(inputElement,message){inputElement.classList.add('error');const errorId = `${inputElement.id}-error`;const errorElement = document.getElementById(errorId);if(errorElement){errorElement.textContent = message;errorElement.style.display = 'block';}}function getFieldLabel(inputElement){const labelElement = document.querySelector(`label[for="${inputElement.id}"]`);if(labelElement){return labelElement.textContent.replace('*','').trim();}return 'This field';}function initContactForm(){const contactForm = document.getElementById('contact-form');const formSuccess = document.getElementById('form-success');const sendAnotherBtn = document.getElementById('send-another');if(!contactForm)return;addCSRFProtection(contactForm);const submissionRateLimit = setupRateLimit('form_submission',5,3600000);contactForm.addEventListener('submit',function(e){e.preventDefault();if(!submissionRateLimit.check()){alert('Too many form submissions. Please try again later.');return;}if(validateForm(contactForm)){const submitButton = contactForm.querySelector('button[type="submit"]');submitButton.disabled = true;submitButton.textContent = 'Sending...';const formData = new FormData(contactForm);const secureData ={};for(const [key,value] of formData.entries()){secureData[key] = sanitizeInput(value);}const honeypot = contactForm.querySelector('.honeypot-field');if(honeypot && honeypot.value){console.log('Bot submission detected');simulateSuccess();return;}setTimeout(()=>{submissionRateLimit.increment();contactForm.style.display = 'none';formSuccess.style.display = 'block';contactForm.reset();submitButton.disabled = false;submitButton.textContent = 'Send Message';formSuccess.scrollIntoView({behavior:'smooth',block:'start'});},1500);}});const formInputs = contactForm.querySelectorAll('.form-control');formInputs.forEach(input =>{input.addEventListener('blur',function(){if(this.value.trim()){this.value = sanitizeInput(this.value);}});input.addEventListener('input',function(){this.classList.remove('error');const errorId = `${this.id}-error`;const errorElement = document.getElementById(errorId);if(errorElement){errorElement.style.display = 'none';}});});if(sendAnotherBtn){sendAnotherBtn.addEventListener('click',function(){formSuccess.style.display = 'none';contactForm.style.display = 'block';});}addHoneypotField(contactForm);}function addCSRFProtection(form){const token = generateRandomToken(32);sessionStorage.setItem('csrf_token',token);const tokenInput = document.createElement('input');tokenInput.type = 'hidden';tokenInput.name = 'csrf_token';tokenInput.value = token;form.appendChild(tokenInput);const metaToken = document.createElement('meta');metaToken.name = 'csrf-token';metaToken.content = token;document.head.appendChild(metaToken);}function generateRandomToken(length){const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let result = '';for(let i = 0;i < length;i++){result += chars.charAt(Math.floor(Math.random()* chars.length));}return result;}function addHoneypotField(form){const honeypotContainer = document.createElement('div');honeypotContainer.style.opacity = '0';honeypotContainer.style.position = 'absolute';honeypotContainer.style.height = '0';honeypotContainer.style.overflow = 'hidden';const honeypotField = document.createElement('input');honeypotField.type = 'text';honeypotField.name = 'website';honeypotField.className = 'honeypot-field';honeypotField.autocomplete = 'off';honeypotContainer.appendChild(honeypotField);form.appendChild(honeypotContainer);}function setupRateLimit(actionName,limit,timeWindow){return{check:function(){const now = Date.now();const storageKey = `rateLimit_${actionName}`;const storedData = localStorage.getItem(storageKey);let data = storedData ? JSON.parse(storedData):{count:0,timestamp:now};if(now - data.timestamp > timeWindow){data ={count:0,timestamp:now};}return data.count < limit;},increment:function(){const now = Date.now();const storageKey = `rateLimit_${actionName}`;const storedData = localStorage.getItem(storageKey);let data = storedData ? JSON.parse(storedData):{count:0,timestamp:now};if(now - data.timestamp > timeWindow){data ={count:1,timestamp:now};}else{data.count++;}localStorage.setItem(storageKey,JSON.stringify(data));}};}function lazyLoadImages(){if('IntersectionObserver' in window){const imgObserver = new IntersectionObserver((entries,observer)=>{entries.forEach(entry =>{if(entry.isIntersecting){const img = entry.target;const src = img.getAttribute('data-src');if(src){img.onload =()=>{img.classList.add('loaded');};img.src = src;img.removeAttribute('data-src');}observer.unobserve(img);}});},{rootMargin:'50px 0px',threshold:0.1});const bgObserver = new IntersectionObserver((entries,observer)=>{entries.forEach(entry =>{if(entry.isIntersecting){const element = entry.target;const bg = element.getAttribute('data-bg');if(bg){const tempImg = new Image();tempImg.onload =()=>{element.style.backgroundImage = `url('${bg}')`;element.classList.add('loaded');};tempImg.src = bg;element.removeAttribute('data-bg');}observer.unobserve(element);}});},{rootMargin:'50px 0px',threshold:0.1});document.querySelectorAll('img[data-src]').forEach(img =>{img.classList.add('lazy-image');imgObserver.observe(img);});document.querySelectorAll('.lazy-background').forEach(element =>{bgObserver.observe(element);});const heroSection = document.querySelector('.hero-section');if(heroSection){bgObserver.observe(heroSection);}const companyImage = document.querySelector('.company-image');if(companyImage){bgObserver.observe(companyImage);}}else{document.querySelectorAll('img[data-src]').forEach(img =>{img.src = img.getAttribute('data-src');img.removeAttribute('data-src');img.classList.add('loaded');});document.querySelectorAll('.lazy-background').forEach(element =>{const bg = element.getAttribute('data-bg');if(bg){element.style.backgroundImage = `url('${bg}')`;element.classList.add('loaded');element.removeAttribute('data-bg');}});const heroSection = document.querySelector('.hero-section');if(heroSection){heroSection.classList.add('loaded');}const companyImage = document.querySelector('.company-image');if(companyImage){companyImage.classList.add('loaded');}}}function initProjectsSlider(){const sliderContainer = document.querySelector('.slider-container');const slides = document.querySelectorAll('.slider-slide');const prevArrow = document.querySelector('.prev-arrow');const nextArrow = document.querySelector('.next-arrow');const dots = document.querySelectorAll('.slider-dot');if(!sliderContainer || slides.length === 0)return;let currentSlide = 0;let slideWidth = 100;let slidesToShow = 1;function updateSlidesToShow(){if(window.innerWidth >= 992){slidesToShow = 3;}else if(window.innerWidth >= 768){slidesToShow = 2;}else{slidesToShow = 1;}slideWidth = 100 / slidesToShow;slides.forEach(slide =>{slide.style.flex = `0 0 ${slideWidth}%`;slide.style.maxWidth = `${slideWidth}%`;});goToSlide(currentSlide);}function goToSlide(slideIndex){if(slideIndex < 0){slideIndex = 0;}else if(slideIndex > slides.length - slidesToShow){slideIndex = slides.length - slidesToShow;}currentSlide = slideIndex;const offset = -slideIndex * slideWidth;sliderContainer.style.transform = `translateX(${offset}%)`;dots.forEach((dot,index)=>{dot.classList.toggle('active',index === currentSlide);});if(prevArrow)prevArrow.style.opacity = currentSlide === 0 ? '0.5':'1';if(nextArrow)nextArrow.style.opacity = currentSlide >= slides.length - slidesToShow ? '0.5':'1';}if(prevArrow){prevArrow.addEventListener('click',()=>{goToSlide(currentSlide - 1);});}if(nextArrow){nextArrow.addEventListener('click',()=>{goToSlide(currentSlide + 1);});}dots.forEach((dot,index)=>{dot.addEventListener('click',()=>{goToSlide(index);});});let autoRotateInterval;function startAutoRotate(){autoRotateInterval = setInterval(()=>{let nextSlide = currentSlide + 1;if(nextSlide > slides.length - slidesToShow){nextSlide = 0;}goToSlide(nextSlide);},5000);}function stopAutoRotate(){clearInterval(autoRotateInterval);}startAutoRotate();sliderContainer.addEventListener('mouseenter',stopAutoRotate);sliderContainer.addEventListener('mouseleave',startAutoRotate);let touchStartX = 0;let touchEndX = 0;sliderContainer.addEventListener('touchstart',(e)=>{touchStartX = e.changedTouches[0].screenX;stopAutoRotate();},{passive:true});sliderContainer.addEventListener('touchend',(e)=>{touchEndX = e.changedTouches[0].screenX;handleSwipe();startAutoRotate();},{passive:true});function handleSwipe(){const swipeThreshold = 50;if(touchEndX < touchStartX - swipeThreshold){goToSlide(currentSlide + 1);}else if(touchEndX > touchStartX + swipeThreshold){goToSlide(currentSlide - 1);}}window.addEventListener('resize',updateSlidesToShow);updateSlidesToShow();}function initTestimonials(){const testimonialItems = document.querySelectorAll('.testimonial-item');const navItems = document.querySelectorAll('.testimonial-nav-item');if(testimonialItems.length <= 1 || navItems.length === 0)return;testimonialItems.forEach((item,index)=>{if(index !== 0){item.style.display = 'none';}});navItems.forEach((navItem,index)=>{navItem.addEventListener('click',()=>{testimonialItems.forEach(item =>{item.style.display = 'none';});testimonialItems[index].style.display = 'block';navItems.forEach(item =>{item.classList.remove('active');});navItem.classList.add('active');});});let currentTestimonial = 0;const autoRotateInterval = setInterval(()=>{currentTestimonial =(currentTestimonial + 1)% testimonialItems.length;testimonialItems.forEach(item =>{item.style.display = 'none';});testimonialItems[currentTestimonial].style.display = 'block';navItems.forEach(item =>{item.classList.remove('active');});navItems[currentTestimonial].classList.add('active');},8000);navItems.forEach(navItem =>{navItem.addEventListener('click',()=>{clearInterval(autoRotateInterval);});});}window.addEventListener('load',lazyLoadImages);function initServiceDetailNavigation(){const serviceLinks = document.querySelectorAll('.service-link');if(serviceLinks.length === 0)return;serviceLinks.forEach(link =>{link.addEventListener('click',function(e){if(window.location.pathname.includes('services.html')){const targetId = this.getAttribute('href');const targetElement = document.querySelector(targetId);if(targetElement){e.preventDefault();const headerHeight = document.querySelector('.site-header').offsetHeight;const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight - 20;window.scrollTo({top:targetPosition,behavior:'smooth'});history.pushState(null,null,targetId);}}});});if(window.location.hash && window.location.pathname.includes('services.html')){const targetElement = document.querySelector(window.location.hash);if(targetElement){setTimeout(()=>{const headerHeight = document.querySelector('.site-header').offsetHeight;const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - headerHeight - 20;window.scrollTo({top:targetPosition,behavior:'smooth'});},300);}}}document.addEventListener('DOMContentLoaded',function(){initServiceDetailNavigation();});function initProjectsFilter(){if(!document.querySelector('.projects-filter'))return;const projects = [{id:1,name:"Kisumu Heights Apartments",location:"kisumu",type:"residential",status:"completed",year:2024,image:"../images/projects/kisumu-heights.jpg",description:"A modern residential complex with 24 luxury apartments."},{id:2,name:"Nakuru Business Center",location:"nakuru",type:"commercial",status:"completed",year:2023,image:"../images/projects/nakuru-business.jpg",description:"A 5-story commercial building with office spaces and retail outlets."},{id:3,name:"Ndhiwa Community Hospital",location:"ndhiwa",type:"commercial",status:"completed",year:2023,image:"../images/projects/ndhiwa-hospital.jpg",description:"A modern healthcare facility serving the Ndhiwa community."},{id:4,name:"Eldoret Industrial Park",location:"eldoret",type:"industrial",status:"ongoing",year:2025,image:"../images/projects/eldoret-industrial.jpg",description:"A large-scale industrial development with multiple factory units."},{id:5,name:"Kisumu Waterfront Villas",location:"kisumu",type:"residential",status:"ongoing",year:2025,image:"../images/projects/kisumu-waterfront.jpg",description:"Luxury lakeside villas with private docks and gardens."},{id:6,name:"Nakuru Highway Bridge",location:"nakuru",type:"infrastructure",status:"completed",year:2022,image:"../images/projects/nakuru-bridge.jpg",description:"A reinforced concrete bridge spanning the Nakuru-Eldoret highway."}];const locationFilter = document.getElementById('location-filter');const typeFilter = document.getElementById('type-filter');const statusFilter = document.getElementById('status-filter');const clearFiltersBtn = document.getElementById('clear-filters');const activeFiltersContainer = document.getElementById('active-filters');const projectsGrid = document.getElementById('projects-grid');const currentFilters ={location:'all',type:'all',status:'all'};function initProjectsGrid(){projectsGrid.innerHTML = '';renderProjects(filterProjects(projects));}function filterProjects(projectsList){return projectsList.filter(project =>{const locationMatch = currentFilters.location === 'all' || project.location === currentFilters.location;const typeMatch = currentFilters.type === 'all' || project.type === currentFilters.type;const statusMatch = currentFilters.status === 'all' || project.status === currentFilters.status;return locationMatch && typeMatch && statusMatch;});}function renderProjects(filteredProjects){projectsGrid.innerHTML = '';if(filteredProjects.length === 0){projectsGrid.innerHTML = '<p class="no-results">No projects match your filter criteria. Please try different filters.</p>';return;}filteredProjects.forEach(project =>{const projectCard = document.createElement('div');projectCard.className = 'project-card';projectCard.setAttribute('data-project-id',project.id);const imageUrl = project.image || '../images/projects/placeholder.jpg';const statusClass = project.status === 'completed' ? 'status-completed':'status-ongoing';projectCard.innerHTML = ` <div class="project-image" style="background-image:url('${imageUrl}')"> <span class="project-status ${statusClass}">${project.status}</span> </div> <div class="project-details"> <h3>${project.name}</h3> <div class="project-meta"> <span class="project-location">${capitalizeFirstLetter(project.location)}</span> <span class="project-year">${project.year}</span> </div> <p>${project.description}</p> <a href="#" class="btn btn-outline view-project-details" data-project-id="${project.id}">View Details</a> </div> `;projectsGrid.appendChild(projectCard);});document.querySelectorAll('.view-project-details').forEach(button =>{button.addEventListener('click',function(e){e.preventDefault();const projectId = parseInt(this.getAttribute('data-project-id'));console.log(`View details for project ${projectId}`);});});}function updateActiveFilters(){activeFiltersContainer.innerHTML = '';const hasActiveFilters = Object.values(currentFilters).some(value => value !== 'all');if(!hasActiveFilters){activeFiltersContainer.style.display = 'none';return;}activeFiltersContainer.style.display = 'flex';Object.entries(currentFilters).forEach(([key,value])=>{if(value !== 'all'){const filterTag = document.createElement('span');filterTag.className = 'filter-tag';const filterName = key.charAt(0).toUpperCase()+ key.slice(1);const filterValue = capitalizeFirstLetter(value);filterTag.innerHTML = ` ${filterName}:${filterValue}<button class="remove-filter" data-filter-type="${key}" aria-label="Remove ${filterName}filter">Ã—</button> `;activeFiltersContainer.appendChild(filterTag);}});document.querySelectorAll('.remove-filter').forEach(button =>{button.addEventListener('click',function(){const filterType = this.getAttribute('data-filter-type');currentFilters[filterType] = 'all';document.getElementById(`${filterType}-filter`).value = 'all';updateActiveFilters();renderProjects(filterProjects(projects));});});}function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+ string.slice(1);}locationFilter.addEventListener('change',function(){currentFilters.location = this.value;updateActiveFilters();renderProjects(filterProjects(projects));});typeFilter.addEventListener('change',function(){currentFilters.type = this.value;updateActiveFilters();renderProjects(filterProjects(projects));});statusFilter.addEventListener('change',function(){currentFilters.status = this.value;updateActiveFilters();renderProjects(filterProjects(projects));});clearFiltersBtn.addEventListener('click',function(){currentFilters.location = 'all';currentFilters.type = 'all';currentFilters.status = 'all';locationFilter.value = 'all';typeFilter.value = 'all';statusFilter.value = 'all';updateActiveFilters();renderProjects(filterProjects(projects));});setTimeout(initProjectsGrid,500);}document.addEventListener('DOMContentLoaded',function(){initProjectsFilter();});function initProjectDetailView(){if(!document.querySelector('.project-modal'))return;const modal = document.getElementById('project-detail-modal');const modalOverlay = document.getElementById('modal-overlay');const closeButtons = document.querySelectorAll('.close-modal,.close-modal-btn');const contactButton = document.getElementById('modal-contact-btn');const projectsExtended = [{id:1,name:"Kisumu Heights Apartments",location:"kisumu",type:"residential",status:"completed",year:2024,image:"../images/projects/kisumu-heights.jpg",description:"A modern residential complex with 24 luxury apartments featuring contemporary design and premium amenities. Located in the heart of Kisumu city with easy access to shopping centers,schools,and healthcare facilities.",features:[ "24 luxury apartments ranging from 1 to 3 bedrooms","Rooftop swimming pool and recreation area","24/7 security with CCTV surveillance","Underground parking for residents","Solar water heating system","Backup generator for uninterrupted power supply" ],gallery:[ "../images/projects/kisumu-heights.jpg","../images/projects/placeholder.jpg","../images/projects/placeholder.jpg" ]},{id:2,name:"Nakuru Business Center",location:"nakuru",type:"commercial",status:"completed",year:2023,image:"../images/projects/nakuru-business.jpg",description:"A 5-story commercial building with modern office spaces and retail outlets. The building features energy-efficient design,ample parking,and state-of-the-art facilities for businesses of all sizes.",features:[ "5 floors of premium office and retail space","Energy-efficient glass facade","High-speed elevators","Central air conditioning system","Dedicated server rooms with backup power","Conference facilities and meeting rooms" ],gallery:[ "../images/projects/nakuru-business.jpg","../images/projects/placeholder.jpg","../images/projects/placeholder.jpg" ]},{id:3,name:"Ndhiwa Community Hospital",location:"ndhiwa",type:"commercial",status:"completed",year:2023,image:"../images/projects/ndhiwa-hospital.jpg",description:"A modern healthcare facility serving the Ndhiwa community with outpatient and inpatient services. The hospital was designed with patient comfort and efficient healthcare delivery in mind.",features:[ "50-bed capacity with private and general wards","Modern operating theaters","Diagnostic imaging center","Pharmacy and laboratory services","Emergency department with ambulance bay","Maternity wing with neonatal care unit" ],gallery:[ "../images/projects/ndhiwa-hospital.jpg","../images/projects/placeholder.jpg","../images/projects/placeholder.jpg" ]},{id:4,name:"Eldoret Industrial Park",location:"eldoret",type:"industrial",status:"ongoing",year:2025,image:"../images/projects/eldoret-industrial.jpg",description:"A large-scale industrial development with multiple factory units,warehouses,and logistics facilities. The project aims to boost manufacturing and create employment opportunities in the region.",features:[ "10 factory units of varying sizes","Central logistics hub with loading bays","Dedicated power substation","Water treatment and recycling plant","Administrative offices and staff facilities","Secure perimeter with controlled access" ],gallery:[ "../images/projects/eldoret-industrial.jpg","../images/projects/placeholder.jpg","../images/projects/placeholder.jpg" ]},{id:5,name:"Kisumu Waterfront Villas",location:"kisumu",type:"residential",status:"ongoing",year:2025,image:"../images/projects/kisumu-waterfront.jpg",description:"Luxury lakeside villas with private docks and gardens,offering an exclusive living experience with breathtaking views of Lake Victoria. Each villa is designed with sustainability and luxury in mind.",features:[ "10 exclusive villas with 4-5 bedrooms each","Private docks with boat access to Lake Victoria","Infinity pools overlooking the lake","Smart home automation systems","Landscaped gardens with indigenous plants","Solar power and rainwater harvesting systems" ],gallery:[ "../images/projects/kisumu-waterfront.jpg","../images/projects/placeholder.jpg","../images/projects/placeholder.jpg" ]},{id:6,name:"Nakuru Highway Bridge",location:"nakuru",type:"infrastructure",status:"completed",year:2022,image:"../images/projects/nakuru-bridge.jpg",description:"A reinforced concrete bridge spanning the Nakuru-Eldoret highway,designed to improve traffic flow and enhance safety for motorists and pedestrians. The bridge incorporates modern engineering techniques for durability and strength.",features:[ "200-meter span with reinforced concrete construction","Pedestrian walkways on both sides","LED lighting system for improved visibility","Expansion joints for temperature fluctuations","Drainage system to prevent water accumulation","Safety barriers and guardrails" ],gallery:[ "../images/projects/nakuru-bridge.jpg","../images/projects/placeholder.jpg","../images/projects/placeholder.jpg" ]}];function openProjectModal(projectId){const project = projectsExtended.find(p => p.id === projectId);if(!project)return;document.getElementById('modal-project-title').textContent = project.name;document.getElementById('modal-main-image').src = project.image;document.getElementById('modal-main-image').alt = project.name;document.getElementById('modal-location').textContent = capitalizeFirstLetter(project.location);document.getElementById('modal-type').textContent = capitalizeFirstLetter(project.type);document.getElementById('modal-status').textContent = capitalizeFirstLetter(project.status);document.getElementById('modal-year').textContent = project.year;document.getElementById('modal-description').textContent = project.description;const featuresList = document.getElementById('modal-features');featuresList.innerHTML = '';if(project.features && project.features.length > 0){document.getElementById('modal-features-section').style.display = 'block';project.features.forEach(feature =>{const li = document.createElement('li');li.textContent = feature;featuresList.appendChild(li);});}else{document.getElementById('modal-features-section').style.display = 'none';}const thumbnailsContainer = document.getElementById('modal-thumbnails');thumbnailsContainer.innerHTML = '';if(project.gallery && project.gallery.length > 0){project.gallery.forEach((image,index)=>{const thumbnail = document.createElement('div');thumbnail.className = 'thumbnail' +(index === 0 ? ' active':'');thumbnail.innerHTML = `<img src="${image}" alt="${project.name}- Image ${index + 1}">`;thumbnail.addEventListener('click',function(){document.getElementById('modal-main-image').src = image;document.querySelectorAll('.thumbnail').forEach(thumb =>{thumb.classList.remove('active');});thumbnail.classList.add('active');});thumbnailsContainer.appendChild(thumbnail);});}modal.classList.add('active');modalOverlay.classList.add('active');document.body.style.overflow = 'hidden';}function closeProjectModal(){modal.classList.remove('active');modalOverlay.classList.remove('active');document.body.style.overflow = '';}document.addEventListener('click',function(e){if(e.target.closest('.view-project-details')){e.preventDefault();const projectId = parseInt(e.target.closest('.view-project-details').getAttribute('data-project-id'));openProjectModal(projectId);}});closeButtons.forEach(button =>{button.addEventListener('click',closeProjectModal);});modalOverlay.addEventListener('click',closeProjectModal);modal.addEventListener('click',function(e){e.stopPropagation();});document.addEventListener('keydown',function(e){if(e.key === 'Escape' && modal.classList.contains('active')){closeProjectModal();}});if(contactButton){contactButton.addEventListener('click',function(){closeProjectModal();window.location.href = 'contact.html';});}function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+ string.slice(1);}}document.addEventListener('DOMContentLoaded',function(){initProjectDetailView();});function initGoogleMaps(){const directionsBtn = document.querySelector('.map-directions-btn');if(directionsBtn){directionsBtn.addEventListener('click',function(e){console.log('Opening directions in Google Maps');});}}function enhanceIOSTouchEvents(){if(/iPad|iPhone|iPod/.test(navigator.userAgent)){const testimonialItems = document.querySelectorAll('.testimonial-nav-item');testimonialItems.forEach(item =>{item.addEventListener('touchend',function(e){e.preventDefault();this.click();});});const sliderArrows = document.querySelectorAll('.slider-arrow');sliderArrows.forEach(arrow =>{arrow.addEventListener('touchend',function(e){e.preventDefault();this.click();});});}}function fixSafariIntersectionObserver(){const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(isSafari && 'IntersectionObserver' in window){const originalObserve = IntersectionObserver.prototype.observe;IntersectionObserver.prototype.observe = function(target){setTimeout(()=>{originalObserve.call(this,target);},50);};}}function fixEdgeCSSVariables(){const isEdge = /Edge\/\d./i.test(navigator.userAgent);if(isEdge){document.documentElement.style.setProperty('--color-dark-brown','#5D4037');document.documentElement.style.setProperty('--color-medium-brown','#8D6E63');document.documentElement.style.setProperty('--color-sage-green','#7CB342');document.documentElement.style.setProperty('--color-warm-gray','#757575');document.documentElement.style.setProperty('--color-light-beige','#F5F5DC');}}document.addEventListener('DOMContentLoaded',function(){enhanceIOSTouchEvents();fixSafariIntersectionObserver();fixEdgeCSSVariables();});function loadNonCriticalCSS(){const normalizeCSS = document.getElementById('normalize-css');const mainCSS = document.getElementById('main-css');if(normalizeCSS)normalizeCSS.media = 'all';if(mainCSS)mainCSS.media = 'all';console.log('Non-critical CSS loaded');}